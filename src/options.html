<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Vrome</title>
  </head>
  <body onload="init()">
    <script src="shared/settings.js" type="text/javascript" charset="utf-8"></script>
		<script src="assets/application.js" type="text/javascript" charset="utf-8"></script>

		<script src="modules/buffer.js" type="text/javascript" charset="utf-8"></script>
		<script src="modules/chinese-pinyin.js" type="text/javascript" charset="utf-8"></script>
		<script src="modules/clipboard.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/cmd-box.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/cmd-line.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/debug.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/get-key.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/hint.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/history.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/insert-mode.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/key-event.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/page.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/scroll.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/search.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/tab.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/url.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/utils.js" type="text/javascript" charset="utf-8"></script>
    <script src="modules/zoom.js" type="text/javascript" charset="utf-8"></script>


    <style type="text/css">
      body {
        width : 800px;
        margin : 50px auto;
        background: #eee;
      }

      #heading {
        text-align: center;
      }

      .header {
        margin: 20px auto 0;
      }

      .disable_site {
        width : 250px;
        margin: 10px 10px 0 0;
      }
    </style>

    <h3 id="heading">Vrome Options</h3>
		<h5><a href="http://github.com/jinzhu" target="_blank">ZhangJinzhu</a></h5>
		<h5><a href="mailto:wosmvp@gmail.com">wosmvp@gmail.com</a></h5>
		<h5><a href="http://github.com/jinzhu/vrome" target="_blank">http://github.com/jinzhu/vrome</a></h5>
    <br/>

    <div class="header"> Editor </div>
    <input onchange="saveEditor(this.value)" type="text" id="vrome_editor"/>

    <div class="header"> Disable Sites (Regexp) </div>
    <div id="disable_sites"></div>

    <!-- BEGIN config hotkeys -->
    <div class="header"> HotKeys </div>
    <textarea id='hotkeys' rows="8" cols="60"></textarea><br/>
    <input id='hotkey-save' type="submit" value="Save" onclick="saveHotkeys();"><br/><br/>

    Add HotKey -- Normal Mode:<br/>
    <input id='hotkey-keys-normalMode' type="TEXT" value="">
    <select id='hotkey-functions-normalMode'></select>
    <input id='hotkey-submit' type="submit" value="Submit" onclick="submitHotkeys('normalMode');">
    <br/>
    Add HotKey -- Insert Mode:<br/>
    <input id='hotkey-keys-insertMode' type="TEXT" value="">
    <select id='hotkey-functions-insertMode'></select>
    <input id='hotkey-submit' type="submit" value="Submit" onclick="submitHotkeys('insertMode');"><br/>
    Add HotKey -- Command Mode:<br/>
    <input id='hotkey-keys-commandMode' type="TEXT" value="">
    <select id='hotkey-functions-commandMode'></select>
    <input id='hotkey-submit' type="submit" value="Submit" onclick="submitHotkeys('commandMode');">

    <script type="text/javascript" charset="utf-8">
      function submitHotkeys(mode) {
        var current_hotkey = document.getElementById('hotkey-keys-' + mode).value + "\t\t" + document.getElementById('hotkey-functions-' + mode).value + "\t\t" + mode;
        var original_value = document.getElementById('hotkeys').value;
        var hotkeys        = (original_value ? (original_value + "\n") : '') + current_hotkey;
        // FIXME duplicate key
        document.getElementById('hotkeys').value = hotkeys;
        saveHotkeys();
      }

      function saveHotkeys() {
        var hotkeys_text = document.getElementById('hotkeys').value.split("\n");
        var hotkeys      = [];
        for(var i in hotkeys_text) {
          hotkeys.push(hotkeys_text[i].split(/\s+/));
        }
        Settings.add({ hotkeys : hotkeys});
      }

      function addHotkeyFunctions(mode,value) {
        var select = document.getElementById('hotkey-functions-' + mode);
        select.options[select.options.length] = new Option(value,value);
      }

      function initHotkey() {
        var hotkeys = Settings.get('hotkeys');
        var hotkeys_text = '';
        for(var i = 0;i < hotkeys.length; i++) {
          hotkeys_text += hotkeys[i][0] + "\t\t" + hotkeys[i][1] + "\t\t" + hotkeys[i][2] + "\n";
        }
        document.getElementById('hotkeys').value = hotkeys_text.replace(/\n$/,'');

        var modules = ['Buffer','CmdLine','History','Scroll','Search','Zoom','InsertMode','Clipboard','KeyEvent','Tab','CmdBox','Hint','Page','Url'];
        for(var i in modules) {
          for(var j in window[modules[i]]) {
            var value = modules[i] + '.' + j;
            if (window[modules[i]][j].private)     { continue; }
            if (window[modules[i]][j].insertMode)  { addHotkeyFunctions('insertMode',value);  }
            if (window[modules[i]][j].commandMode) { addHotkeyFunctions('commandMode',value); }
            if (window[modules[i]][j].normalMode)  { addHotkeyFunctions('normalMode',value);  }
          }
        }
      }
      // getkey directly from keyboard

      initHotkey();
    </script>
    <!-- END config hotkeys -->
  </body>
</html>
