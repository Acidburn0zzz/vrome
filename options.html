<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>Vimlike Smooziee</title>
  </head>

  <body onload="init()">
    <script type="text/javascript" charset="utf-8">
      var removeButton = document.createElement('img');
      removeButton.setAttribute('class','remove_buttons');
      removeButton.setAttribute('onclick','removeElements([this.parentNode],true)');
      removeButton.setAttribute('src','icons/remove.png');

      var addButton = document.createElement('img');
      addButton.setAttribute('class','add_buttons');
      addButton.setAttribute('onclick','addSite()');
      addButton.setAttribute('src','icons/add.png');

      function saveData(){
        var elements = document.getElementsByClassName('disable_site');
        var data = '';
        for(var i = 0;i < elements.length;i++){
          if(/\S\s+\S/.test(elements[i].value)){
            alert("don't allow blank");
            return;
          }
          data += " " + elements[i].value;
        }
        localStorage.disableSites = data;
        console.log(localStorage.disableSites);
      }

      function addSite(value) {
        var div    = document.getElementById('disable_sites');

        var newBox = document.createElement('div');
        newBox.setAttribute('class','disable_site_box');
        var input  = document.createElement('input')
        input.setAttribute('onblur','saveData()');
        input.setAttribute('class','disable_site');

        newBox.appendChild(input);
        div.appendChild(newBox);

        value ? (input.value = value) : addIcons();
      }

      function removeElements(elements,addicon){
        var length  = elements.length;
        for(var i = 0;i < length;i++){
          elements[0].parentNode.removeChild(elements[0]);
        }
        saveData();
        if(addicon) addIcons();
      }

      function addIcons() {
        var elements = document.getElementsByClassName('disable_site_box');
        var removeAble = elements.length > 1;

        removeElements(document.getElementsByClassName('add_buttons'));
        removeElements(document.getElementsByClassName('remove_buttons'));

        for(var i = 0;i < elements.length ; i++){
          elements[i].appendChild(removeButton.cloneNode());
        }

        elements[i-1].appendChild(addButton);
      }

      function init() {
        var disable_sites = (localStorage.disableSites || '').split(' ');
        for(var i in disable_sites){
          if(!/^\s*$/.test(disable_sites[i])) addSite(disable_sites[i]);
        }
        addSite('');
        addIcons();
      }
    </script>

    <style type="text/css">
      body {
        width : 800px;
        margin : 50px auto;
        text-align: center;
        background: #eee;
      }

      #disable_sites_heading {
        margin: 50px auto 0;
      }

      #disable_sites {
        margin : 10px 0 0 250px;
        text-align: left;
      }

      .disable_site {
        width : 250px;
        margin: 10px;
      }
    </style>

    <h3 id="heading">Vimlike Smooziee Options</h3>
    <h5>
      <a href="http://github.com/jinzhu" target="_blank">ZhangJinzhu</a>
      - <a href="mailto:wosmvp@gmail.com">wosmvp@gmail.com</a>
      - <a href="http://github.com/jinzhu/vimlike-smooziee" target="_blank">http://github.com/jinzhu/vimlike-smooziee</a>
    </h5>

    <h6 id="disable_sites_heading"> Disable Sites </h6>
    <div id="disable_sites">
    </div>
  </body>
</html>
